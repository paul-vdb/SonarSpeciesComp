<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul van Dam-Bates">
<meta name="dcterms.date" content="2026-01-06">
<meta name="description" content="An overview of how to estimate species composition using SonarSpeciesComp.">

<title>Estimating Species Composition</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SpeciesComposition_files/libs/clipboard/clipboard.min.js"></script>
<script src="SpeciesComposition_files/libs/quarto-html/quarto.js"></script>
<script src="SpeciesComposition_files/libs/quarto-html/popper.min.js"></script>
<script src="SpeciesComposition_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SpeciesComposition_files/libs/quarto-html/anchor.min.js"></script>
<link href="SpeciesComposition_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SpeciesComposition_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SpeciesComposition_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SpeciesComposition_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SpeciesComposition_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimating Species Composition</h1>
</div>

<div>
  <div class="description">
    <p>An overview of how to estimate species composition using <code>SonarSpeciesComp</code>.</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Paul van Dam-Bates </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 6, 2026</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The R package <code>SonarSpeciesComp</code> is intended to estimate species composition for fish observed by the hydroacoustic monitoring programs at either Qualark (Fisheries and Oceans Canada), or Mission (Pacific Salmon Commission)</p>
<p>The basic idea is to use hydroacoustic length measurements combined with nearby test fishery counts to identify the proportion of each species migrating each day. A day at Mission runs from 5:00 - 4:59 and at Qualark it is 00:00 - 23:59.</p>
</section>
<section id="data-types" class="level2">
<h2 class="anchored" data-anchor-id="data-types">Data Types</h2>
<section id="hydroacoustic-counts" class="level3">
<h3 class="anchored" data-anchor-id="hydroacoustic-counts">Hydroacoustic Counts</h3>
<p>Every hour hydroacoustic counts are taken in each sonar bin using an ARIS 1800. At Qualark the sonar is rolled 35 degrees to be able to enumerate all fish along a steep bank. At Mission, the right bank is relatively flat and a single aim with no roll is sufficient for full coverage. However, on the left bank, two aims are used within the first 10 m to enumerate all fish. At both sites, counts are done by bank, and 10 m distance bins. Qualark completes counts out to 30 m, or 3 bins on each bank, and Mission out to 50 m. Counts are labelled as Up and Down for the number of fish counted as swimming upstream or down stream.</p>
<p>The package requires count data as a data frame with columns that are slightly specific for each site.</p>
<ol type="1">
<li>Mission requirements:</li>
</ol>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;         Date MissionDate Hour SonarCode SonarAim SonarBin Up.0to5 Dn.0to5
#&gt; 1 2023-09-01  2023-09-02    5        A1     Aim1     Bin1       5       1
#&gt;   Up.5to10 Dn.5to10 MinsCounted
#&gt; 1       NA       NA           5</code></pre>
</div>
<ol start="2" type="1">
<li>Qualark requirements:</li>
</ol>
<p><strong><em>Under construction</em></strong> Need to decide input when getting back into this data based on database output.</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;         Date Hour SonarBin SonarBank Up Down Duration
#&gt; 1 2023-09-01    5     Bin1 Left Bank  5    3       20</code></pre>
</div>
</section>
<section id="hydroacoustic-lengths" class="level3">
<h3 class="anchored" data-anchor-id="hydroacoustic-lengths">Hydroacoustic Lengths</h3>
<p>At Mission, hydroacoustic lengths are taken for 20 fish, every three hours in each sonar Aim, Bin, and Bank. Sonar bins 1-3 are measured, with distances further than that unreliable for length measurement. Similarly, at Qualark, measurement lengths follow the same process but for 2 distance bins, and a single aim due to a target roll angle of 35 degrees.</p>
<ol type="1">
<li>Mission requirements (order does not matter):</li>
</ol>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;         Date MissionDate Hour SonarCode SonarAim SonarBin EnterTheta.deg R.m
#&gt; 1 2023-09-01  2023-09-02    5        A1     Aim1     Bin1            7.5 6.3
#&gt;   L.cm
#&gt; 1 55.1</code></pre>
</div>
<ol start="2" type="1">
<li>Qualark requirements:</li>
</ol>
<p><strong><em>Under construction</em></strong> Need to decide input when getting back into this data based on database output.</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;         Date Hour SonarBin      Bank R.m L.cm
#&gt; 1 2023-09-01    5     Bin1 Left Bank 6.3 55.1</code></pre>
</div>
<p>Additional columns can be added here as covariates for a linear model of the species proportions. We will naturally add <code>"day"</code> and <code>"SonarAimf"</code> which creates a factor of the sonar aim with Aim3 referring to all aims that are not aim 1/2 near shore on left bank.</p>
</section>
<section id="test-fishery-catches" class="level3">
<h3 class="anchored" data-anchor-id="test-fishery-catches">Test Fishery Catches</h3>
<p>At Mission, the Whonnock test fishery operates just downstream of the site. A gillnet does two sets at the daytime high tide (targets the larger tide) for 30 minutes each. The number of sockeye, pink salmon, jack Chinook and adult Chinook are counted as either gilled or tangled. Additionally, fork lengths are also recorded. For counts, the raw data are combined for the day, with the setStart referring to the time the first net is set <code>"FE_NET_START_OUT_DTT"</code>.</p>
<ol type="1">
<li>Mission requirements (order does not matter):</li>
</ol>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;     TRIP_DTT            setStart nSets Pink.All.Gilled Pink.All.Tangled
#&gt; 1 2023-09-01 2023-09-01 11:54:00     2               5                7
#&gt;   Sockeye.Adult.Gilled Sockeye.Adult.Tangled Chinook.Jack.Gilled
#&gt; 1                    7                     3                   0
#&gt;   Chinook.Jack.Tangled Chinook.Adult.Gilled Chinook.Adult.Tangled
#&gt; 1                    1                    2                     3</code></pre>
</div>
</section>
</section>
<section id="estimating-species-composition" class="level2">
<h2 class="anchored" data-anchor-id="estimating-species-composition">Estimating Species Composition</h2>
<p>As we get closer to final test version, I will build a wrapper function that does a lot of the following steps as a single run. For now this section shows all the detailed control that is currently available.</p>
<p>The species composition model operates through an R6 object called <code>speciesCompSummary</code>. To create a new version,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>speciesComp <span class="ot">&lt;-</span> speciesCompSummary<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">species =</span> <span class="fu">c</span>(<span class="st">"largeresident"</span>, <span class="st">"jackchinook"</span>, <span class="st">"sockeye"</span>, <span class="st">"adultchinook"</span>), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">site =</span> <span class="st">"Mission"</span>, <span class="at">estDate =</span> <span class="st">"2023-08-05"</span>, <span class="at">ndays =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We set the species we are interested in, the date we want to estimate the number of days previous to include, and the site, which informs the model how to do data processing and whether to use a roll angle or not. Site cannot be changed later, but dates and species can be.</p>
<p>The steps do do analysis are the following:</p>
<div>
<ol type="1">
<li>Process data (counts and lengths) that we will use for analysis <code>processData</code>.</li>
<li>Set Date and the number of days to use for analysis <code>setDate</code>.</li>
<li>Set the species that we are interested in <code>setSpecies</code>.</li>
<li>Choose mean and standard deviation of lengths for different species <code>setSpeciesLengths</code>.</li>
<li>Setup the linear models for proportions of each species <code>setModelProportions</code>.</li>
<li>Choose what kind of length adjustments to do (e.g.&nbsp;beam width correction) <code>setLengthAdjustment</code>.</li>
<li>Choose which parameters are fixed and which should be estimated <code>setModelParameters</code>.</li>
<li>Choose how to penalize different parameters <code>setPriors</code>.</li>
<li>Control optimization for the EM algorithm <code>controlOptimization</code>.</li>
<li>Fit the model using the EM algorithm <code>fitModel</code>.</li>
</ol>
</div>
<p>The first step is to do data processing. For testing, the object will take in a full year of data to avoid doing data processing multiple times when running the model over a larger time period. It also makes it easy to test different versions of the model, such as the number of days etc.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">processData</span>(sonarCounts, sonarLengths, testFisheryCounts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then explicitly choose, and/or change the date and the species we will use for analysis of that day, as well as the number of days.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setDate</span>(<span class="at">estDate =</span> <span class="st">"2023-08-10"</span>, <span class="at">ndays =</span> <span class="dv">3</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setSpecies</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">"largeresident"</span>, <span class="st">"jackchinook"</span>, <span class="st">"sockeye"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"smalladultchinook"</span>,  <span class="st">"largeadultchinook"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="prior-species-lengths" class="level3">
<h3 class="anchored" data-anchor-id="prior-species-lengths">Prior Species Lengths</h3>
<p>To choose mean and standard deviation of each species lengths, we use <code>setSpeciesLengths</code>. We can provide our own values, or use test fishery lengths. In particular, we will use the test fishery data to differentiate jack/small/large Chinook. The test fishery data should have columns,</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt;         Date FL.cm Species
#&gt; 1 2023-09-01  58.5 Sockeye</code></pre>
</div>
<p>We can then choose each species length values by,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setSpeciesLengths</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="st">"largeresident"</span> <span class="ot">=</span> <span class="dv">42</span>), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma =</span> <span class="fu">c</span>(<span class="st">"largeresident"</span> <span class="ot">=</span> <span class="fl">2.25</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">testFisheryLengths =</span> testFisheryLengths, <span class="at">ndays =</span> <span class="dv">10</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span>parameters<span class="sc">$</span>mu</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; largeresident       sockeye </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      42.00000      59.65455</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span>parameters<span class="sc">$</span>sigma</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; largeresident       sockeye </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      2.250000      3.421456</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span>parameters<span class="sc">$</span>muChin</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       jackchinook smalladultchinook largeadultchinook </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          42.44950          74.36022          77.24167</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span>parameters<span class="sc">$</span>sigmaChin</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       jackchinook smalladultchinook largeadultchinook </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         0.7499998         7.8928442         2.7248193</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span>parameters<span class="sc">$</span>pChin</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.01751189 0.67580976 0.30667836</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelling-proportions" class="level3">
<h3 class="anchored" data-anchor-id="modelling-proportions">Modelling Proportions</h3>
<p>Here is where we set the actual analysis data for a specific date. The function <code>setModelProportions</code> allows us to control the linear model for modelling the covariate effect on species composition. By default we assume that they are all the for non-Chinook species, with <code>-1 + stratum:day</code>. In this case, <code>stratum</code> is a column generated by code in the data processing that is a combination of sonar bin, sonar aim, sonar code (or bank).</p>
<p>The user may also choose whether or not to add a model to jack Chinook. Assuming it is constant by default, matches their proportion to have the same relationship as adult Chinook, and only models a constant different in proportion from adult Chinook. To change all formulas, use <code>formula = list(all = ~-1+day)</code>. If we want to change jack Chinook, that formula term is <code>formula = list("largeresident" = ~-1+SonarBin:SonarAim, "jackchinook" = ~1)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setModelProportions</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="length-adjustments" class="level3">
<h3 class="anchored" data-anchor-id="length-adjustments">Length Adjustments</h3>
<p>If we believe that there are biases in the hydroacoustic length measurements, then here is where to set the correction. We consider two main types of corrections, either for beam spreading, or using a beam spreading correction for each sonar bin.</p>
<p>Beam width adjustment is included by:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setLengthAdjustment</span>(<span class="at">formula =</span> <span class="sc">~</span> beamWidth.cm, <span class="at">adjustLengths =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>beamWidth.cm</code> is a column generated automatically when calling <code>processData</code>. To adjust by sonar bin:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setLengthAdjustment</span>(<span class="at">formula =</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> SonarBin, <span class="at">adjustLengths =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the same time it is fine to choose to not adjust lengths <code>adjustLengths = FALSE</code>.</p>
</section>
<section id="model-parameter-setup" class="level3">
<h3 class="anchored" data-anchor-id="model-parameter-setup">Model Parameter Setup</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setModelParameters</span>(<span class="at">fixedParameters =</span> <span class="fu">c</span>(<span class="st">"mu"</span>, <span class="st">"sigma"</span>, <span class="st">"muChinook"</span>, <span class="st">"sigmaChinook"</span>),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameterValues =</span> <span class="fu">list</span>(<span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>), <span class="at">sigma0 =</span> <span class="dv">5</span>), <span class="at">testFisheryWeights =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choosing-priorspenalties" class="level3">
<h3 class="anchored" data-anchor-id="choosing-priorspenalties">Choosing Priors/Penalties</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">setPriors</span>(<span class="at">priors =</span> <span class="fu">list</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(<span class="fu">dnorm</span>(x, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">9</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">log =</span> <span class="cn">TRUE</span>))}, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma0 =</span>  <span class="cf">function</span>(x){<span class="fu">sum</span>(<span class="fu">dgamma</span>(x, <span class="dv">1</span>, <span class="fl">0.2</span>, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">log</span>(x))},</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">catchability =</span>  <span class="cf">function</span>(x){<span class="fu">sum</span>(<span class="fu">dnorm</span>(x, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.01</span>), <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">log</span>(x))},</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span>  <span class="cf">function</span>(x){<span class="fu">sum</span>(<span class="fu">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">10</span>, <span class="at">log =</span> <span class="cn">TRUE</span>))},</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">alphaJackChinook =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(<span class="fu">dnorm</span>(x, <span class="sc">-</span><span class="dv">3</span>, <span class="fl">0.1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>))}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="controlling-optimization" class="level3">
<h3 class="anchored" data-anchor-id="controlling-optimization">Controlling Optimization</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">controlOptimization</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-fitting" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting">Model Fitting</h3>
<p>EM Algorithm and how it works…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>speciesComp<span class="sc">$</span><span class="fu">fitModel</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Running EM Algorithm</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ===</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; number of iterations = 41 </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Convergence was evaluated based on the difference of the log likelihood: 8.629286e-09 .</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>